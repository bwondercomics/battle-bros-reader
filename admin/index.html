<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5" />
<title>Battle Bros Admin - Content Editor</title>
<meta name="robots" content="noindex, nofollow" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Righteous&family=Bebas+Neue&display=swap" rel="stylesheet" />

<style>
/* ==================== CSS VARIABLES ==================== */
:root {
  --primary: #00d9ff;
  --secondary: #ff00ea;
  --accent: #ffed00;
  --bg-dark: #0a0a12;
  --bg-panel: #1a1a2e;
  --text: #ffffff;
  --danger: #ff3838;
  --success: #00ff88;
}

/* ==================== RESET ==================== */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* ==================== ANIMATIONS ==================== */
@keyframes glitchText {
  0%, 100% { text-shadow: 2px 2px 0 var(--primary), -2px -2px 0 var(--secondary); }
  25% { text-shadow: -2px 2px 0 var(--secondary), 2px -2px 0 var(--primary); }
  50% { text-shadow: 2px -2px 0 var(--primary), -2px 2px 0 var(--secondary); }
  75% { text-shadow: -2px -2px 0 var(--secondary), 2px 2px 0 var(--primary); }
}

@keyframes scanline {
  0% { transform: translateY(-100%); }
  100% { transform: translateY(100%); }
}

@keyframes neonPulse {
  0%, 100% { box-shadow: 0 0 5px var(--primary), 0 0 10px var(--primary); }
  50% { box-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary); }
}

@keyframes pixelShift {
  0%, 100% { transform: translate(0, 0); }
  25% { transform: translate(2px, 0); }
  50% { transform: translate(0, 2px); }
  75% { transform: translate(-2px, 0); }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ==================== BASE LAYOUT ==================== */
html, body {
  background: var(--bg-dark);
  color: var(--text);
  font-family: 'Righteous', cursive;
  min-height: 100vh;
  overflow-x: hidden;
}

body {
  background-image: 
    repeating-linear-gradient(
      0deg,
      rgba(0, 217, 255, 0.03) 0px,
      transparent 1px,
      transparent 2px,
      rgba(0, 217, 255, 0.03) 3px
    );
  position: relative;
}

/* Scanline effect */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    to bottom,
    transparent 50%,
    rgba(0, 217, 255, 0.05) 50%
  );
  background-size: 100% 4px;
  pointer-events: none;
  z-index: 9999;
  animation: scanline 8s linear infinite;
}

/* ==================== LOGIN SCREEN ==================== */
#loginScreen {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
}

.login-container {
  background: var(--bg-panel);
  border: 2px solid var(--primary);
  border-radius: 10px;
  padding: 40px;
  max-width: 400px;
  width: 100%;
  box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
  animation: fadeIn 0.5s ease-out;
}

.login-title {
  font-family: 'Bebas Neue', cursive;
  font-size: 2.5rem;
  color: var(--primary);
  text-align: center;
  margin-bottom: 10px;
  animation: glitchText 3s ease-in-out infinite;
}

.login-subtitle {
  text-align: center;
  color: var(--accent);
  font-size: 0.9rem;
  margin-bottom: 30px;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.login-form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-label {
  font-size: 0.9rem;
  color: var(--primary);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.form-input {
  background: var(--bg-dark);
  border: 2px solid var(--primary);
  color: var(--text);
  padding: 12px 16px;
  font-family: 'Righteous', cursive;
  font-size: 1rem;
  border-radius: 5px;
  transition: all 0.3s ease;
}

.form-input:focus {
  outline: none;
  box-shadow: 0 0 15px rgba(0, 217, 255, 0.5);
  animation: neonPulse 1s ease-in-out infinite;
}

.btn-primary {
  background: var(--primary);
  color: var(--bg-dark);
  border: none;
  padding: 14px 24px;
  font-family: 'Bebas Neue', cursive;
  font-size: 1.3rem;
  letter-spacing: 2px;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-transform: uppercase;
  font-weight: bold;
}

.btn-primary:hover {
  background: var(--accent);
  box-shadow: 0 0 20px rgba(255, 237, 0, 0.6);
  transform: translateY(-2px);
}

.btn-primary:active {
  transform: translateY(0);
}

.error-message {
  background: var(--danger);
  color: var(--text);
  padding: 12px;
  border-radius: 5px;
  text-align: center;
  font-size: 0.9rem;
  animation: pixelShift 0.3s ease-in-out;
}

/* ==================== ADMIN DASHBOARD ==================== */
#adminDashboard {
  display: none;
  min-height: 100vh;
}

.admin-header {
  background: var(--bg-panel);
  border-bottom: 2px solid var(--primary);
  padding: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 15px;
}

.admin-title {
  font-family: 'Bebas Neue', cursive;
  font-size: 2rem;
  color: var(--primary);
  animation: glitchText 5s ease-in-out infinite;
}

.admin-nav {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.btn-secondary {
  background: transparent;
  border: 2px solid var(--secondary);
  color: var(--secondary);
  padding: 8px 16px;
  font-family: 'Righteous', cursive;
  font-size: 0.9rem;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-transform: uppercase;
}

.btn-secondary:hover {
  background: var(--secondary);
  color: var(--bg-dark);
  box-shadow: 0 0 15px rgba(255, 0, 234, 0.5);
}

.btn-logout {
  background: transparent;
  border: 2px solid var(--danger);
  color: var(--danger);
  padding: 8px 16px;
  font-family: 'Righteous', cursive;
  font-size: 0.9rem;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-transform: uppercase;
}

.btn-logout:hover {
  background: var(--danger);
  color: var(--text);
  box-shadow: 0 0 15px rgba(255, 56, 56, 0.5);
}

.admin-content {
  padding: 30px 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.section {
  background: var(--bg-panel);
  border: 2px solid var(--primary);
  border-radius: 10px;
  padding: 30px;
  margin-bottom: 30px;
  box-shadow: 0 0 20px rgba(0, 217, 255, 0.2);
}

.section-title {
  font-family: 'Bebas Neue', cursive;
  font-size: 1.8rem;
  color: var(--accent);
  margin-bottom: 20px;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.chapter-list {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.chapter-item {
  background: var(--bg-dark);
  border: 2px solid var(--primary);
  border-radius: 5px;
  padding: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 15px;
  transition: all 0.3s ease;
}

.chapter-item:hover {
  box-shadow: 0 0 15px rgba(0, 217, 255, 0.4);
  transform: translateX(5px);
}

.chapter-info {
  flex: 1;
  min-width: 200px;
}

.chapter-name {
  font-size: 1.2rem;
  color: var(--primary);
  margin-bottom: 5px;
}

.chapter-meta {
  font-size: 0.85rem;
  color: var(--text);
  opacity: 0.7;
}

.chapter-actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.btn-small {
  padding: 6px 12px;
  font-size: 0.8rem;
  border-radius: 3px;
  border: none;
  cursor: pointer;
  font-family: 'Righteous', cursive;
  transition: all 0.3s ease;
  text-transform: uppercase;
}

.btn-edit {
  background: var(--primary);
  color: var(--bg-dark);
}

.btn-edit:hover {
  box-shadow: 0 0 10px var(--primary);
}

.btn-delete {
  background: transparent;
  border: 1px solid var(--danger);
  color: var(--danger);
}

.btn-delete:hover {
  background: var(--danger);
  color: var(--text);
}

.btn-add {
  background: var(--accent);
  color: var(--bg-dark);
  padding: 12px 24px;
  font-size: 1rem;
  margin-top: 20px;
}

.btn-add:hover {
  box-shadow: 0 0 20px var(--accent);
}

/* ==================== EDITOR MODAL ==================== */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(10, 10, 18, 0.95);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  padding: 20px;
  overflow-y: auto;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: var(--bg-panel);
  border: 2px solid var(--primary);
  border-radius: 10px;
  padding: 30px;
  max-width: 600px;
  width: 100%;
  box-shadow: 0 0 30px rgba(0, 217, 255, 0.5);
  animation: fadeIn 0.3s ease-out;
  max-height: 90vh;
  overflow-y: auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.modal-title {
  font-family: 'Bebas Neue', cursive;
  font-size: 1.8rem;
  color: var(--primary);
}

.btn-close {
  background: transparent;
  border: none;
  color: var(--danger);
  font-size: 2rem;
  cursor: pointer;
  line-height: 1;
  padding: 0;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-close:hover {
  color: var(--text);
}

.form-editor {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.page-list {
  background: var(--bg-dark);
  border: 2px solid var(--primary);
  border-radius: 5px;
  padding: 15px;
  max-height: 300px;
  overflow-y: auto;
}

.page-item {
  background: var(--bg-panel);
  border: 1px solid var(--primary);
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 3px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}

.page-path {
  font-size: 0.85rem;
  color: var(--text);
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
}

.btn-remove {
  background: transparent;
  border: 1px solid var(--danger);
  color: var(--danger);
  padding: 4px 8px;
  font-size: 0.7rem;
  cursor: pointer;
  border-radius: 3px;
}

.btn-remove:hover {
  background: var(--danger);
  color: var(--text);
}

.btn-add-page {
  background: var(--accent);
  color: var(--bg-dark);
  padding: 8px 16px;
  font-size: 0.9rem;
  margin-top: 10px;
}

.modal-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 20px;
}

.btn-save {
  background: var(--success);
  color: var(--bg-dark);
  padding: 10px 24px;
  font-size: 1rem;
  border: none;
  cursor: pointer;
  border-radius: 5px;
  font-family: 'Bebas Neue', cursive;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.btn-save:hover {
  box-shadow: 0 0 20px var(--success);
}

.btn-cancel {
  background: transparent;
  border: 2px solid var(--text);
  color: var(--text);
  padding: 10px 24px;
  font-size: 1rem;
  cursor: pointer;
  border-radius: 5px;
  font-family: 'Bebas Neue', cursive;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.btn-cancel:hover {
  background: var(--text);
  color: var(--bg-dark);
}

/* ==================== PREVIEW SECTION ==================== */
.preview-container {
  background: var(--bg-dark);
  border: 2px solid var(--accent);
  border-radius: 5px;
  padding: 20px;
  margin-top: 20px;
}

.preview-title {
  font-family: 'Bebas Neue', cursive;
  font-size: 1.3rem;
  color: var(--accent);
  margin-bottom: 15px;
}

.preview-data {
  background: var(--bg-panel);
  border: 1px solid var(--primary);
  border-radius: 3px;
  padding: 15px;
  font-family: monospace;
  font-size: 0.85rem;
  color: var(--primary);
  overflow-x: auto;
  max-height: 400px;
  overflow-y: auto;
}

.export-actions {
  display: flex;
  gap: 10px;
  margin-top: 20px;
  flex-wrap: wrap;
}

.btn-copy {
  background: var(--primary);
  color: var(--bg-dark);
}

.btn-download {
  background: var(--secondary);
  color: var(--text);
}

.success-message {
  background: var(--success);
  color: var(--bg-dark);
  padding: 12px;
  border-radius: 5px;
  text-align: center;
  margin-top: 15px;
  font-size: 0.9rem;
  animation: fadeIn 0.3s ease-out;
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 768px) {
  .admin-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .admin-title {
    font-size: 1.5rem;
  }
  
  .chapter-item {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .modal-content {
    padding: 20px;
  }
  
  .login-container {
    padding: 30px 20px;
  }
}
</style>
</head>
<body>

<!-- ==================== LOGIN SCREEN ==================== -->
<div id="loginScreen">
  <div class="login-container">
    <h1 class="login-title">ADMIN ACCESS</h1>
    <p class="login-subtitle">Battle Bros Editor</p>
    <form id="loginForm" class="login-form">
      <div class="form-group">
        <label class="form-label" for="password">Password</label>
        <input 
          type="password" 
          id="password" 
          class="form-input" 
          placeholder="Enter admin password"
          required
        />
      </div>
      <button type="submit" class="btn-primary">Login</button>
    </form>
    <div id="loginError" style="display: none; margin-top: 15px;"></div>
  </div>
</div>

<!-- ==================== ADMIN DASHBOARD ==================== -->
<div id="adminDashboard">
  <header class="admin-header">
    <h1 class="admin-title">Battle Bros Admin</h1>
    <nav class="admin-nav">
      <button class="btn-secondary" id="btnPreview">Preview Changes</button>
      <button class="btn-logout" id="btnLogout">Logout</button>
    </nav>
  </header>

  <main class="admin-content">
    <!-- Chapter Management Section -->
    <section class="section">
      <h2 class="section-title">Chapter Management</h2>
      <div id="chapterList" class="chapter-list"></div>
      <button class="btn-small btn-add" id="btnAddChapter">+ Add New Chapter</button>
    </section>

    <!-- Preview/Export Section -->
    <section class="section" id="previewSection" style="display: none;">
      <h2 class="section-title">Preview & Export</h2>
      <div class="preview-container">
        <h3 class="preview-title">Chapter Data (JSON)</h3>
        <pre id="previewData" class="preview-data"></pre>
        <div class="export-actions">
          <button class="btn-small btn-copy" id="btnCopy">Copy to Clipboard</button>
          <button class="btn-small btn-download" id="btnDownload">Download JSON</button>
        </div>
        <div id="copySuccess" style="display: none;"></div>
      </div>
      <p style="margin-top: 20px; color: var(--accent); font-size: 0.9rem;">
        üìù <strong>Instructions:</strong> Copy this JSON and replace the "chapters" object in index.html (around line 1762)
      </p>
    </section>
  </main>
</div>

<!-- ==================== EDIT CHAPTER MODAL ==================== -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="modalTitle">Edit Chapter</h2>
      <button class="btn-close" id="btnCloseModal">&times;</button>
    </div>
    <form id="editForm" class="form-editor">
      <div class="form-group">
        <label class="form-label" for="chapterName">Chapter Name</label>
        <input 
          type="text" 
          id="chapterName" 
          class="form-input" 
          placeholder="e.g., Chapter 1"
          required
        />
      </div>
      
      <div class="form-group">
        <label class="form-label">Pages (Image Paths)</label>
        <div id="pageList" class="page-list"></div>
        <button type="button" class="btn-small btn-add-page" id="btnAddPage">+ Add Page</button>
      </div>
      
      <div class="modal-actions">
        <button type="button" class="btn-cancel" id="btnCancelEdit">Cancel</button>
        <button type="submit" class="btn-save">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<script>
(function() {
  'use strict';

  // ==================== STATE MANAGEMENT ====================
  const ADMIN_PASSWORD = 'battlebros2024'; // TODO: Use more secure auth in production
  const STORAGE_KEY = 'battlebros_admin_data';
  const SESSION_KEY = 'battlebros_admin_session';

  let chapters = {};
  let currentEditingChapter = null;

  // ==================== DOM ELEMENTS ====================
  const el = {
    loginScreen: document.getElementById('loginScreen'),
    loginForm: document.getElementById('loginForm'),
    loginError: document.getElementById('loginError'),
    adminDashboard: document.getElementById('adminDashboard'),
    chapterList: document.getElementById('chapterList'),
    btnAddChapter: document.getElementById('btnAddChapter'),
    btnLogout: document.getElementById('btnLogout'),
    btnPreview: document.getElementById('btnPreview'),
    previewSection: document.getElementById('previewSection'),
    previewData: document.getElementById('previewData'),
    btnCopy: document.getElementById('btnCopy'),
    btnDownload: document.getElementById('btnDownload'),
    copySuccess: document.getElementById('copySuccess'),
    editModal: document.getElementById('editModal'),
    modalTitle: document.getElementById('modalTitle'),
    editForm: document.getElementById('editForm'),
    chapterName: document.getElementById('chapterName'),
    pageList: document.getElementById('pageList'),
    btnAddPage: document.getElementById('btnAddPage'),
    btnCloseModal: document.getElementById('btnCloseModal'),
    btnCancelEdit: document.getElementById('btnCancelEdit')
  };

  // ==================== AUTHENTICATION ====================
  
  function checkSession() {
    const session = sessionStorage.getItem(SESSION_KEY);
    if (session === 'authenticated') {
      showDashboard();
      return true;
    }
    return false;
  }

  function login(password) {
    if (password === ADMIN_PASSWORD) {
      sessionStorage.setItem(SESSION_KEY, 'authenticated');
      showDashboard();
      return true;
    }
    return false;
  }

  function logout() {
    sessionStorage.removeItem(SESSION_KEY);
    el.loginScreen.style.display = 'flex';
    el.adminDashboard.style.display = 'none';
    document.getElementById('password').value = '';
  }

  function showDashboard() {
    el.loginScreen.style.display = 'none';
    el.adminDashboard.style.display = 'block';
    loadChapters();
    renderChapterList();
  }

  // ==================== DATA MANAGEMENT ====================
  
  function loadChapters() {
    // Try to load from localStorage first (saved drafts)
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      try {
        chapters = JSON.parse(saved);
        return;
      } catch (e) {
        console.error('Error loading saved data:', e);
      }
    }
    
    // Default chapters data (from current website)
    chapters = {
      "Chapter 1": [
        "chapters/01/01.png",
        "chapters/01/02.png",
        "chapters/01/03.png",
        "chapters/01/04.png",
        "chapters/01/05.png",
        "chapters/01/06.png",
        "chapters/01/07.png",
        "chapters/01/08.png",
        "banner1.png",
        "banner2.png"
      ],
      "Chapter 2": [
        "chapters/02/01.png",
        "chapters/02/02.png",
        "chapters/02/03.png",
        "chapters/02/04.png",
        "chapters/02/05.png",
        "chapters/02/06.png",
        "chapters/02/07.png",
        "chapters/02/08.png"
      ],
      "Chapter 3": [
        "chapters/03/01.png",
        "chapters/03/02.png",
        "chapters/03/03.png",
        "chapters/03/04.png",
        "chapters/03/05.png",
        "chapters/03/06.png",
        "chapters/03/07.png",
        "chapters/03/08.png",
        "chapters/03/09.png",
        "chapters/03/10.png",
        "chapters/03/11.png",
        "chapters/03/12.png",
        "chapters/03/13.png",
        "chapters/03/14.png"
      ],
      "Chapter 4": [
        "chapters/04/01.png",
        "chapters/04/02.png",
        "chapters/04/03.png",
        "chapters/04/04.png",
        "chapters/04/05.png",
        "chapters/04/06.png",
        "chapters/04/07.png",
        "chapters/04/08.png",
        "chapters/04/09.png",
        "chapters/04/10.png"
      ],
      "Chapter 5": [
        "chapters/05/01.png",
        "chapters/05/02.png",
        "chapters/05/03.png",
        "chapters/05/04.png",
        "chapters/05/05.png",
        "chapters/05/06.png",
        "chapters/05/07.png",
        "chapters/05/08.png",
        "chapters/05/09.png",
        "chapters/05/10.png",
        "chapters/05/11.png",
        "chapters/05/12.png"
      ],
      "Chapter 6": [
        "chapters/06/01.png",
        "chapters/06/02.png",
        "chapters/06/03.png",
        "chapters/06/04.png",
        "chapters/06/05.png",
        "chapters/06/06.png",
        "chapters/06/07.png",
        "chapters/06/08.png",
        "chapters/06/09.png",
        "chapters/06/10.png",
        "chapters/06/11.png",
        "chapters/06/12.png",
        "chapters/06/13.png",
        "chapters/06/14.png",
        "chapters/06/15.png"
      ],
      "Chapter 7": [
        "chapters/07/01.png",
        "chapters/07/02.png",
        "chapters/07/03.png",
        "chapters/07/04.png",
        "chapters/07/05.png",
        "chapters/07/06.png",
        "chapters/07/07.png",
        "chapters/07/08.png",
        "chapters/07/09.png",
        "chapters/07/10.png",
        "chapters/07/11.png"
      ]
    };
  }

  function saveChapters() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(chapters));
  }

  // ==================== UI RENDERING ====================
  
  function renderChapterList() {
    el.chapterList.innerHTML = '';
    
    const chapterNames = Object.keys(chapters);
    chapterNames.forEach((name, index) => {
      const pages = chapters[name];
      const item = document.createElement('div');
      item.className = 'chapter-item';
      item.innerHTML = `
        <div class="chapter-info">
          <div class="chapter-name">${escapeHtml(name)}</div>
          <div class="chapter-meta">${pages.length} pages</div>
        </div>
        <div class="chapter-actions">
          <button class="btn-small btn-edit" data-chapter="${escapeHtml(name)}">Edit</button>
          <button class="btn-small btn-delete" data-chapter="${escapeHtml(name)}">Delete</button>
        </div>
      `;
      el.chapterList.appendChild(item);
    });
    
    // Attach event listeners
    document.querySelectorAll('.btn-edit').forEach(btn => {
      btn.addEventListener('click', () => editChapter(btn.dataset.chapter));
    });
    
    document.querySelectorAll('.btn-delete').forEach(btn => {
      btn.addEventListener('click', () => deleteChapter(btn.dataset.chapter));
    });
  }

  function renderPageList(pages) {
    el.pageList.innerHTML = '';
    
    pages.forEach((path, index) => {
      const item = document.createElement('div');
      item.className = 'page-item';
      item.innerHTML = `
        <span class="page-path">${escapeHtml(path)}</span>
        <button class="btn-remove" data-index="${index}">Remove</button>
      `;
      el.pageList.appendChild(item);
    });
    
    // Attach event listeners
    document.querySelectorAll('.btn-remove').forEach(btn => {
      btn.addEventListener('click', () => removePage(parseInt(btn.dataset.index)));
    });
  }

  // ==================== CHAPTER OPERATIONS ====================
  
  function editChapter(chapterName) {
    currentEditingChapter = chapterName;
    el.modalTitle.textContent = 'Edit Chapter';
    el.chapterName.value = chapterName;
    renderPageList(chapters[chapterName] || []);
    showModal();
  }

  function addNewChapter() {
    currentEditingChapter = null;
    el.modalTitle.textContent = 'Add New Chapter';
    el.chapterName.value = '';
    renderPageList([]);
    showModal();
  }

  function deleteChapter(chapterName) {
    if (confirm(`Are you sure you want to delete "${chapterName}"?`)) {
      delete chapters[chapterName];
      saveChapters();
      renderChapterList();
    }
  }

  function saveChapterEdit() {
    const newName = el.chapterName.value.trim();
    if (!newName) {
      alert('Chapter name is required');
      return;
    }
    
    // Get all pages
    const pages = [];
    el.pageList.querySelectorAll('.page-path').forEach(span => {
      const path = span.textContent.trim();
      if (path) pages.push(path);
    });
    
    // Delete old chapter if name changed
    if (currentEditingChapter && currentEditingChapter !== newName) {
      delete chapters[currentEditingChapter];
    }
    
    // Save new/updated chapter
    chapters[newName] = pages;
    saveChapters();
    renderChapterList();
    hideModal();
  }

  function addPage() {
    const path = prompt('Enter image path (e.g., chapters/01/01.png):');
    if (path) {
      const currentPages = [];
      el.pageList.querySelectorAll('.page-path').forEach(span => {
        currentPages.push(span.textContent.trim());
      });
      currentPages.push(path.trim());
      renderPageList(currentPages);
    }
  }

  function removePage(index) {
    const currentPages = [];
    el.pageList.querySelectorAll('.page-path').forEach(span => {
      currentPages.push(span.textContent.trim());
    });
    currentPages.splice(index, 1);
    renderPageList(currentPages);
  }

  // ==================== MODAL MANAGEMENT ====================
  
  function showModal() {
    el.editModal.classList.add('active');
  }

  function hideModal() {
    el.editModal.classList.remove('active');
    currentEditingChapter = null;
  }

  // ==================== PREVIEW & EXPORT ====================
  
  function showPreview() {
    const jsonData = JSON.stringify(chapters, null, 2);
    el.previewData.textContent = jsonData;
    el.previewSection.style.display = 'block';
    el.previewSection.scrollIntoView({ behavior: 'smooth' });
  }

  function copyToClipboard() {
    const jsonData = JSON.stringify(chapters, null, 2);
    navigator.clipboard.writeText(jsonData).then(() => {
      el.copySuccess.textContent = '‚úì Copied to clipboard!';
      el.copySuccess.className = 'success-message';
      el.copySuccess.style.display = 'block';
      setTimeout(() => {
        el.copySuccess.style.display = 'none';
      }, 3000);
    }).catch(err => {
      alert('Failed to copy: ' + err);
    });
  }

  function downloadJSON() {
    const jsonData = JSON.stringify(chapters, null, 2);
    const blob = new Blob([jsonData], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'battle-bros-chapters.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // ==================== UTILITIES ====================
  
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // ==================== EVENT HANDLERS ====================
  
  function attachEventHandlers() {
    // Login
    el.loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const password = document.getElementById('password').value;
      if (!login(password)) {
        el.loginError.textContent = 'Invalid password';
        el.loginError.className = 'error-message';
        el.loginError.style.display = 'block';
      }
    });

    // Logout
    el.btnLogout.addEventListener('click', logout);

    // Add chapter
    el.btnAddChapter.addEventListener('click', addNewChapter);

    // Modal controls
    el.btnCloseModal.addEventListener('click', hideModal);
    el.btnCancelEdit.addEventListener('click', hideModal);
    el.editForm.addEventListener('submit', (e) => {
      e.preventDefault();
      saveChapterEdit();
    });

    // Page management
    el.btnAddPage.addEventListener('click', addPage);

    // Preview & export
    el.btnPreview.addEventListener('click', showPreview);
    el.btnCopy.addEventListener('click', copyToClipboard);
    el.btnDownload.addEventListener('click', downloadJSON);

    // Close modal on backdrop click
    el.editModal.addEventListener('click', (e) => {
      if (e.target === el.editModal) {
        hideModal();
      }
    });
  }

  // ==================== INITIALIZATION ====================
  
  function init() {
    attachEventHandlers();
    if (!checkSession()) {
      el.loginScreen.style.display = 'flex';
      el.adminDashboard.style.display = 'none';
    }
    console.log('‚úì Battle Bros Admin initialized');
  }

  // ==================== START ====================
  
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(init, 0);
  } else {
    document.addEventListener('DOMContentLoaded', init);
  }

})();
</script>
</body>
</html>
